{% extends "base.html" %}

{% block title %}Test Chart: {{ company_name if company_name else ticker }}{% endblock %}

{% block content %}
    <h1>
        Test Chart für {{ company_name if company_name else ticker }}
    </h1>
     <form id="chartOptionsFormTest" method="GET" action="{{ url_for('test_graph_page') }}" style="margin-bottom:20px; display:flex; gap:10px; align-items:center; background-color:transparent; padding:0; flex-wrap:wrap;">
        <input type="hidden" name="ticker_symbol" value="{{ticker}}">
        <div>
            <label for="periodSelectTest" style="font-size:0.85em; margin-right:5px;">Zeitraum:</label>
            <select name="period" id="periodSelectTest" onchange="this.form.submit()" style="padding:6px 8px; font-size:0.9em; border-radius:4px;">
                {% for p_val, p_disp in available_periods %}
                    <option value="{{ p_val }}" {{ 'selected' if current_period == p_val }}>{{ p_disp }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="qualitySelectTest" style="font-size:0.85em; margin-right:5px;">Qualität:</label>
            <select name="quality" id="qualitySelectTest" onchange="this.form.submit()" style="padding:6px 8px; font-size:0.9em; border-radius:4px;">
                {% for q_val, q_disp in available_qualities %}
                    <option value="{{ q_val }}" {{ 'selected' if current_quality == q_val }}>{{ q_disp }}</option>
                {% endfor %}
            </select>
        </div>
        <div style="margin-left: 5px;">
            <input type="checkbox" name="remove_gaps" id="removeGapsCheckboxTest" value="on"
                   onchange="this.form.submit()"
                   {% if current_remove_gaps %}checked{% endif %}>
            <label for="removeGapsCheckboxTest" style="font-size:0.85em;">Keine Lücken</label>
        </div>
    </form>
    <p style="text-align:center; font-size:0.9em; color:#555;">
        Ausgewählt: {{ current_period }}, {{ current_quality }}, Lücken entfernen: {{ "Ja" if current_remove_gaps else "Nein" }}. <br>
        Verwendet für Chart: Periode '{{ actual_period_used }}', Intervall '{{ actual_interval_used }}'.
    </p>

    {% if error %}
         {% if "Hinweis:" in error %}
            <div class="info-box">{{ error }}</div>
        {% else %}
            <div class="error-box">{{ error }}</div>
        {% endif %}
    {% endif %}

    {% if chart_html %}
        <div class="chart-container">
            {{ chart_html | safe }}
        </div>
    {% elif not error %}
        <p>Chart konnte nicht geladen werden.</p>
    {% endif %}
    
    <a href="{{ url_for('search_stock_page') }}" class="footer-link" style="margin-top:20px;">« Zurück zur Ticker-Suche</a>
{% endblock %}