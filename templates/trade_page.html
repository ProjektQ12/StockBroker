{% extends "base.html" %}

{% block title %}Handeln: {{ company_name if company_name and company_name != ticker else ticker }}{% endblock %}

{% block content %}
<div class="content-container" style="max-width: 700px;">
    <h1>
        Handeln: {{ company_name if company_name and company_name != ticker else ticker }}
        {% if company_name and company_name != ticker %}({{ticker}}){% endif %}
    </h1>
    <p style="text-align:center; margin-bottom:20px; font-size:1.1em;">
        Aktueller Kurs: <strong>{{ current_price if current_price != 'N/A' else 'Nicht verfügbar' }}</strong>
    </p>

    {# Schalter für Long/Short/Options #}
    <div class="trade-mode-selector" style="text-align: center; margin-bottom: 25px;">
        <a href="{{ url_for('trade_page', ticker_symbol=ticker, mode='long') }}"
           class="trade-mode-button {{ 'active' if current_mode == 'long' }}">Long</a>
        <a href="{{ url_for('trade_page', ticker_symbol=ticker, mode='short') }}"
           class="trade-mode-button {{ 'active' if current_mode == 'short' }}">Short</a>
        <a href="{{ url_for('trade_page', ticker_symbol=ticker, mode='option') }}"
           class="trade-mode-button {{ 'active' if current_mode == 'option' }}">Optionen</a>
    </div>

    <form method="POST" action="{{ url_for('trade_page', ticker_symbol=ticker, mode=current_mode) }}">

        {# --- LONG Bereich --- #}
        {% if current_mode == 'long' %}
        <div class="trade-section">
            <h2>Long Position eröffnen</h2>
            <div class="form-group">
                <label for="quantity">Stückzahl</label>
                <input type="number" id="quantity" name="quantity" min="1" value="1" required class="form-control">
            </div>
            <div class="form-group">
                <label for="order_type">Order-Typ</label>
                <select id="order_type" name="order_type" class="form-control" onchange="toggleLimitPrice(this.value)">
                    <option value="market" selected>Market (Bestens)</option>
                    <option value="limit">Limit</option>
                </select>
            </div>
            <div class="form-group" id="limitPriceGroup" style="display: none;">
                <label for="limit_price">Limit-Preis</label>
                <input type="number" step="0.01" id="limit_price" name="limit_price" class="form-control" placeholder="z.B. 150.50">
            </div>
            <div class="form-group">
                <label for="validity">Gültigkeit</label>
                <select id="validity" name="validity" class="form-control">
                    <option value="day" selected>Tagesgültig (Day)</option>
                    <option value="gtc">Unbegrenzt (GTC)</option>
                </select>
            </div>
            <button type="submit" class="form-button full-width">Kaufen (Long)</button>
        </div>
        <script>
            function toggleLimitPrice(orderType) {
                const limitGroup = document.getElementById('limitPriceGroup');
                const limitInput = document.getElementById('limit_price');
                if (limitGroup && limitInput) {
                    limitGroup.style.display = orderType === 'limit' ? 'block' : 'none';
                    limitInput.required = orderType === 'limit';
                    if (orderType !== 'limit') {
                        limitInput.value = '';
                    }
                }
            }
            document.addEventListener('DOMContentLoaded', function() {
                const orderTypeSelect = document.getElementById('order_type');
                if (orderTypeSelect) {
                     toggleLimitPrice(orderTypeSelect.value);
                }
            });
        </script>
        {% endif %}

        {# --- SHORT Bereich --- #}
        {% if current_mode == 'short' %}
        <div class="trade-section">
            <h2>Short Position eröffnen</h2>
            <p class="info-box" style="text-align:center; background-color:#fff3cd; color:#664d03; border-color:#ffecb5;">
                Short-Handel ist in dieser Demo-Version noch nicht implementiert.
            </p>
            </div>
        {% endif %}

        {# --- OPTIONS Bereich --- #}
        {% if current_mode == 'option' %}
        <div class="trade-section">
            <h2>Optionshandel</h2>
             <p class="info-box" style="text-align:center; background-color:#fff3cd; color:#664d03; border-color:#ffecb5;">
                Optionshandel ist in dieser Demo-Version noch nicht implementiert.
            </p>
            </div>
        {% endif %}
    </form>
    <div style="text-align:center; margin-top:30px;">
    <a href="{{ url_for('stock_detail_page', ticker_symbol=ticker) }}" class="footer-link">« Zurück zur Detailseite von {{ticker}}</a>
    </div>
</div>
<style>
    .trade-mode-button {
        padding: 10px 18px; margin: 0 5px;
        background-color: #e9ecef; color: #495057;
        border-radius: 6px; text-decoration: none;
        border: 1px solid #ced4da; font-size:0.95em;
        transition: background-color 0.2s, color 0.2s, border-color 0.2s;
    }
    .trade-mode-button:hover {
        background-color: #dbe1e6;
        border-color: #adb5bd;
    }
    .trade-mode-button.active {
        background-color: #0d6efd; color: white;
        border-color: #0d6efd; font-weight: 500;
    }
    .trade-section {
        border: 1px solid #dee2e6; padding: 20px 25px; border-radius: 8px; margin-top: 20px; background-color: #fff;
    }
    .trade-section h2 {
        text-align: left;
        font-size: 1.4em;
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
</style>
{% endblock %}